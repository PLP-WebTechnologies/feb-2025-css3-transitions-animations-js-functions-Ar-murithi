<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Theme Toggle with Animation</title>
  <style>
    body {
      transition: background-color 0.5s, color 0.5s;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .dark-theme {
      background-color: black;
      color: white;
    }

    .light-theme {
      background-color: white;
      color: black;
    }

    #toggleBtn {
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.3s ease;
    }

    #toggleBtn.animate {
      transform: scale(1.2);
    }
  </style>
</head>
<body>

  <button id="toggleBtn">Toggle Theme</button>

  <script>
    const THEME_KEY = 'theme'; // Define a constant for the theme key

    // Check if localStorage is available
    function isLocalStorageAvailable() {
      try {
        const testKey = '__test__';
        localStorage.setItem(testKey, 'test');
        localStorage.removeItem(testKey);
        return true;
      } catch (e) {
        return false;
      }
    }

    // Store user preference in localStorage
    function storePreference(key, value) {
      if (isLocalStorageAvailable()) {
        localStorage.setItem(key, value);
      }
    }

    // Retrieve user preference from localStorage
    function getPreference(key) {
      return isLocalStorageAvailable() ? localStorage.getItem(key) : null;
    }

    // Apply the selected theme to the body
    function applyTheme(theme) {
      document.body.className = `${theme}-theme`;
    }

    // Animate the button with a debounce mechanism
    function animateButton(button) {
      button.disabled = true; // Disable the button during animation
      button.classList.add('animate');
      setTimeout(() => {
        button.classList.remove('animate');
        button.disabled = false; // Re-enable the button after animation
      }, 300);
    }

    // Initialize the theme toggle functionality
    document.addEventListener('DOMContentLoaded', () => {
      const button = document.getElementById('toggleBtn');
      let currentTheme = getPreference(THEME_KEY) || 'light'; // Default to light theme
      applyTheme(currentTheme);

      button.addEventListener('click', () => {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        storePreference(THEME_KEY, currentTheme);
        applyTheme(currentTheme);
        animateButton(button);
      });
    });
  </script>

</body>
</html>
